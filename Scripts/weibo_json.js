const mainConfig={isDebug:!0,removeHomeVip:!0,removeHomeCreatorTask:!0,removeRelate:!0,removeGood:!0,removeFollow:!0,modifyMenus:!0,removeRelateItem:!1,removeRecommendItem:!0,removeRewardItem:!0,removeLiveMedia:!0,removeNextVideo:!1,removePinedTrending:!0,removeInterestFriendInTopic:!1,removeInterestTopic:!1,removeInterestUser:!0,removeLvZhou:!0,removeSearchWindow:!0,profileSkin1:null,profileSkin2:null,tabIconVersion:0,tabIconPath:""},itemMenusConfig={creator_task:!1,mblog_menus_custom:!1,mblog_menus_video_later:!0,mblog_menus_comment_manager:!0,mblog_menus_avatar_widget:!1,mblog_menus_card_bg:!1,mblog_menus_long_picture:!0,mblog_menus_delete:!0,mblog_menus_edit:!0,mblog_menus_edit_history:!0,mblog_menus_edit_video:!0,mblog_menus_sticking:!0,mblog_menus_open_reward:!0,mblog_menus_novelty:!1,mblog_menus_favorite:!0,mblog_menus_promote:!0,mblog_menus_modify_visible:!0,mblog_menus_copy_url:!0,mblog_menus_follow:!0,mblog_menus_video_feedback:!0,mblog_menus_shield:!0,mblog_menus_report:!0,mblog_menus_apeal:!0,mblog_menus_home:!0},modifyCardsUrls=["/cardlist","video/community_tab","searchall"],modifyStatusesUrls=["statuses/friends/timeline","statuses_unread_hot_timeline","statuses/unread_friends_timeline","statuses/unread_hot_timeline","groups/timeline","statuses/friends_timeline"],otherUrls={"/profile/me":"removeHome","/statuses/extend":"itemExtendHandler","/video/remind_info":"removeVideoRemind","/checkin/show":"removeCheckin","/live/media_homelist":"removeMediaHomelist","/comments/build_comments":"removeComments","/container/get_item":"containerHandler","/profile/container_timeline":"userHandler","/video/tiny_stream_video_list":"nextVideoHandler","/2/statuses/video_mixtimeline":"nextVideoHandler","video/tiny_stream_mid_detail":"nextVideoHandler","video/tiny_stream_unified_list":"nextVideoHandler","video/flow_video_list":"nextVideoHandler","video/flow_video_unified":"nextVideoHandler","/!/client/light_skin":"tabSkinHandler","/littleskin/preview":"skinPreviewHandler","/search/finder":"removeSearchMain","/search/container_timeline":"removeSearch","/search/container_discover":"removeSearch","/2/messageflow":"removeMsgAd","/2/page?":"removePage","/statuses/unread_topic_timeline":"topicHandler","/square&pageDataType/":"squareHandler","/statuses/container_timeline_topic":"removeMain","/statuses/container_timeline":"removeMainTab","wbapplua/wbpullad.lua":"removeLuaScreenAds","interface/sdk/sdkad.php":"removePhpScreenAds","a=trends":"removeTopics",user_center:"modifiedUserCenter","a=get_coopen_ads":"removeIntlOpenAds","php?a=search_topic":"removeSearchTopic","ad/realtime":"removeRealtimeAd","ad/preload":"removeAdPreload","php?a=open_app":"removeAdBanner",flowpage:"removeFlowPage",repost_timeline:removeRepostTimeline,"/2/statuses/container_detail_comment":"removeDetailComments","/2/statuses/container_detail_forward":"removeDetailComments","/2/statuses/container_detail":"removeContainerDetail"};function getModifyMethod(e){if(!e||"string"!=typeof e)return null;for(const t of modifyCardsUrls)if(e.includes(t))return"removeCards";for(const t of modifyStatusesUrls)if(e.includes(t))return"removeTimeLine";for(const[t,o]of Object.entries(otherUrls))if(e.includes(t))return o;return null}function removeRealtimeAd(e){return delete e.ads,e.code=4016,e}function removeAdBanner(e){return e.data.close_ad_setting&&delete e.data.close_ad_setting,e.data.detail_banner_ad&&(e.data.detail_banner_ad=[]),e}function removeAdPreload(e){if(!e.ads)return e;e.last_ad_show_interval=86400;for(const t of e.ads)t.start_time=2681574400,t.end_time=2681660799,t.display_duration=0,t.daily_display_cnt=0,t.total_display_cnt=0;return e}function removeIntlOpenAds(e){return e.data&&(e.data={display_ad:1}),e}function removeSearchTopic(e){return e.data&&e.data.search_topic?.cards.length?(e.data.search_topic.cards=Object.values(e.data.search_topic.cards).filter((e=>"searchtop"!=e.type)),e.data.trending_topic&&delete e.data.trending_topic,e):e}function modifiedUserCenter(e){return e.data&&0!==e.data.length?(e.data.cards&&(e.data.cards=Object.values(e.data.cards).filter((e=>"personal_vip"!=e.items[0].type))),e):e}function removeTopics(e){return e.data&&(e.data.order=["search_topic"]),e}function isAd(e){return!(!e||"广告"!==e.mblogtypename&&"热推"!==e.mblogtypename&&"ad"!==e.promotion?.type&&"ad"!==e.page_info?.actionlog?.source&&"广告"!==e.content_auth_info?.content_auth_title&&!e.is_ad_card&&!e.hint)}function squareHandler(e){return e}function removeMainTab(e){if(e.loadedInfo&&e.loadedInfo.headers&&delete e.loadedInfo.headers,!e.items)return e;const t=[];for(const o of e.items)isAd(o.data)||(o.data?.page_info?.video_limit&&delete o.data.page_info.video_limit,o.data?.common_struct&&delete o.data.common_struct,o.category&&"group"===o.category?-1!==JSON.stringify(o.items).indexOf("profile_top")&&t.push(o):t.push(o));return e.items=t,log("removeMainTab success"),e}function removeMain(e){if(e.loadedInfo&&e.loadedInfo.headers&&delete e.loadedInfo.headers,!e.items)return e;const t=[];for(const o of e.items)if("feed"===o.category)isAd(o.data)||t.push(o);else if("group"===o.category){if(o.items.length>0)if(o.items[0].data?.itemid?.includes("search_input"))o.items=o.items.filter((e=>e?.data?.itemid?.includes("mine_topics")||e?.data?.itemid?.includes("search_input")||202==e?.data?.card_type)),o.items[0].data.hotwords=[{word:"搜索超话",tip:""}],t.push(o);else{if(o.items[0].data?.itemid?.includes("top_title"))continue;o.items.length>0?(o.items=Object.values(o.items).filter((e=>"feed"===e.category||"card"===e.category)),t.push(o)):t.push(o)}}else{if(o.data?.card_type&&[202,200].indexOf(o.data.card_type)>-1)continue;t.push(o)}return e.items=t,log("removeMain success"),e}function topicHandler(e){const t=e.cards;if(!t)return e;if(!mainConfig.removeUnfollowTopic&&!mainConfig.removeUnusedPart)return e;const o=[];for(const e of t){let t=!0;if(e.mblog){const o=e.mblog.buttons;mainConfig.removeUnfollowTopic&&o&&"follow"==o[0].type&&(t=!1)}else{if(!mainConfig.removeUnusedPart)continue;if("bottom_mix_activity"==e.itemid)t=!1;else if("正在活跃"==e?.top?.title)t=!1;else if(200==e.card_type&&e.group)t=!1;else{const o=e.card_group;if(!o)continue;const n=o[0];if(["guess_like_title","cats_top_title","chaohua_home_readpost_samecity_title"].indexOf(n.itemid)>-1)t=!1;else if(o.length>1){const t=[];for(const e of o)-1==["chaohua_discovery_banner_1","bottom_mix_activity"].indexOf(e.itemid)&&t.push(e);e.card_group=t}}}t&&o.push(e)}return e.cards=o,log("topicHandler success"),e}function removeSearchMain(e){const t=e.channelInfo.channels;if(!t)return e;const o=[];for(const e of t)e.payload&&(removeSearch(e.payload),delete e.titleInfoAbsorb,delete e.titleInfo,delete e.title,o.push(e));return e.channelInfo.channels=o,e.header?.data&&removeHeader(e.header.data),e.channelInfo?.moreChannels&&(delete e.channelInfo.moreChannels,delete e.channelInfo.channelConfig),log("remove_search main success"),e}function removeHeader(e){if(!e.items)return e;const t=[];for(const o of e.items)"group"===o.category&&(o.items=o.items.filter((e=>null===e.data?.card_type||101===e.data?.card_type||17===e.data?.card_type)),o.items.length>0&&t.push(o));return e.items=t,log("remove Header success"),e}function checkSearchWindow(e){return!(!mainConfig.removeSearchWindow||"card"!==e.category||"finder_window"!==e.data?.itemid&&"discover_gallery"!==e.data?.itemid&&"more_frame"!==e.data?.itemid&&208!==e.data?.card_type&&236!==e.data?.card_type&&247!==e.data?.card_type&&217!==e.data?.card_type&&101!==e.data?.card_type&&19!==e.data?.card_type&&!e.data?.mblog?.page_info?.actionlog?.source?.includes("ad")&&!e.data?.pic?.includes("ads"))}function removeSearch(e){if(!e.items)return e;const t=[];for(const o of e.items)"feed"===o.category?isAd(o.data)||(o.data?.page_info?.video_limit&&delete o.data.page_info.video_limit,t.push(o)):"group"===o.category?"guess"!==o.header?.type&&(o.items=o.items.filter((e=>!isAd(e.data)&&(null==e.data?.card_type||17===e.data?.card_type||10===e.data?.card_type))),o.items.length>0&&t.push(o)):checkSearchWindow(o)||t.push(o);return e.items=t,e.loadedInfo&&(e.loadedInfo.searchBarContent=[],e.loadedInfo.headerBack&&(e.loadedInfo.headerBack.channelStyleMap={})),log("remove_search success"),e}function removeMsgAd(e){if(!e.messages)return e;const t=[];for(const o of e.messages)o.msg_card?.ad_tag||t.push(o);return e.messages=t,e}function removePage(e){return removeCards(e),mainConfig.removePinedTrending&&e.cards&&e.cards.length>0&&e.cards[0].card_group&&(e.cards[0].card_group=e.cards[0].card_group.filter((e=>!(e?.actionlog?.ext?.includes("ads_word")||e?.itemid?.includes("t:51")||e?.itemid?.includes("ads_word"))))),e}function removeCards(e){if(e.hotwords&&(e.hotwords=[]),!e.cards)return e.items&&removeSearch(e),e;const t=[];for(let o of e.cards){"232082type=1"!==e.cardlistInfo?.containerid||17!==o.card_type&&58!==o.card_type&&11!==o.card_type||(o={card_type:o.card_type+1});const n=o.card_group;if(n&&n.length>0){const e=[];for(const t of n)118===t.card_type||isAd(t.mblog)||-1!==JSON.stringify(t).indexOf("res_from:ads")||e.push(t);o.card_group=e,t.push(o)}else{const e=o.card_type;if([9,165].indexOf(e)>-1)isAd(o.mblog)||t.push(o);else{if([1007,180].indexOf(e)>-1)continue;t.push(o)}}}return e.cards=t,e.items&&removeSearch(e),e}function lvZhouHandler(e){if(!mainConfig.removeLvZhou||!e)return e;const t=e.common_struct;if(!t)return e;const o=[];for(const e of t)"绿洲"!==e.name&&o.push(e);return e.common_struct=o,e}function isBlock(e){const t=mainConfig.blockIds||[];if(0===t.length)return!1;const o=e.user.id;for(const e of t)if(e==o)return!0;return!1}function removeTimeLine(e){for(const t of["ad","advertises","trends","headers"])e[t]&&delete e[t];if(!e.statuses)return e;const t=[];for(const o of e.statuses)isAd(o)||(lvZhouHandler(o),o.common_struct&&delete o.common_struct,o.category?"group"!==o.category&&t.push(o):t.push(o));return e.statuses=t,e}function removeHomeVip(e){return e.header&&e.header.vipView&&(e.header.vipView=null),e}function removeVideoRemind(e){e.bubble_dismiss_time=0,e.exist_remind=!1,e.image_dismiss_time=0,e.image="",e.tag_image_english="",e.tag_image_english_dark="",e.tag_image_normal="",e.tag_image_normal_dark=""}function itemExtendHandler(e){e.trend?.titles?.title&&delete e.trend,mainConfig.removeFollow&&e.follow_data&&(e.follow_data=null),mainConfig.removeRewardItem&&e.reward_info&&(e.reward_info=null),e.head_cards&&delete e.head_cards,e.page_alerts&&(e.page_alerts=null);try{e.trend.extra_struct.extBtnInfo.btn_picurl.indexOf("timeline_icon_ad_delete")>-1&&delete e.trend}catch(e){}if(mainConfig.modifyMenus&&e.custom_action_list){const t=[];for(const o of e.custom_action_list){const e=o.type,n=itemMenusConfig[e];void 0===n?t.push(o):"mblog_menus_copy_url"===e?t.unshift(o):n&&t.push(o)}e.custom_action_list=t}return e.share_repost_type=2,e}function updateFollowOrder(e){try{for(const t of e.items)if("mainnums_friends"===t.itemId){const e=t.click.modules[0].scheme;return t.click.modules[0].scheme=e.replace("231093_-_selfrecomm","231093_-_selffollowed"),void log("updateFollowOrder success")}}catch(e){}}function updateProfileSkin(e,t){try{const o=mainConfig[t];if(!o)return;let n=0;for(const t of e.items)if(t.image)try{"alpha"!==t.image.style.darkMode&&(t.image.style.darkMode="alpha"),t.image.iconUrl=o[n++],t.dot&&(t.dot=[])}catch(e){}log("updateProfileSkin success")}catch(e){}}function removeHome(e){if(!e.items)return e;const t=[];for(let o of e.items){const e=o.itemId;"profileme_mine"===e?(mainConfig.removeHomeVip&&(o=removeHomeVip(o)),o.header?.vipIcon&&delete o.header.vipIcon,updateFollowOrder(o),t.push(o)):"100505_-_top8"===e?(updateProfileSkin(o,"profileSkin1"),t.push(o)):"100505_-_newcreator"===e?"grid"===o.type?(updateProfileSkin(o,"profileSkin2"),t.push(o)):mainConfig.removeHomeCreatorTask||t.push(o):"100505_-_chaohua"!==e&&"100505_-_manage"!==e&&"100505_-_recentlyuser"!==e||(o.images?.length>0&&(o.images=o.images.filter((e=>"100505_-_chaohua"===e.itemId||"100505_-_recentlyuser"===e.itemId))),t.push(o))}return e.items=t,e}function removeCheckin(e){return log("remove tab1签到"),e.show=0,e}function removeMediaHomelist(e){return mainConfig.removeLiveMedia&&(log("remove 首页直播"),e.data={}),e}function removeComments(e){const t=e.datas||[];if(!t.length)return e;const o=[];for(const e of t)if("trend"!==e.item_category&&1!==e.data?.user?.extend?.ai_type&&!e.data?.user?.is_vai&&!e.data.reply_ai_type){const t=removeAi(e);o.push(t)}return log("remove 评论区相关和推荐内容"),e.datas=o,e}function removeAi(e){if(e.data.comments?.length){const t=[];for(const o of e.data.comments)o.user.is_vai||o.reply_ai_type||t.push(o);e.data.comments=t}return e}function containerHandler(e){return mainConfig.removeInterestFriendInTopic&&"超话里的好友"===e.card_type_name&&(log("remove 超话里的好友"),e.card_group=[]),mainConfig.removeInterestTopic&&e.itemid&&(e.itemid.indexOf("infeed_may_interest_in")>-1?(log("remove 感兴趣的超话"),e.card_group=[]):e.itemid.indexOf("infeed_friends_recommend")>-1&&(log("remove 超话好友关注"),e.card_group=[])),e}function userHandler(e){if(e=removeMainTab(e),!mainConfig.removeInterestUser)return e;if(!e.items)return e;const t=[];for(const o of e.items){let e=!0;if("group"===o.category)try{"可能感兴趣的人"===o.items[0].data.desc&&(e=!1)}catch(e){}e&&(o.data?.common_struct&&delete o.data.common_struct,t.push(o))}return e.items=t,log("removeMain sub success"),e}function nextVideoHandler(e){return e.statuses&&(e.statuses=[]),e.items&&(e.items=[]),log("nextVideoHandler success"),e}function tabSkinHandler(e){try{const t=mainConfig.tabIconVersion;if(e.data.canUse=1,!t||!mainConfig.tabIconPath||t<100)return e;const o=e.data.list;for(const e of o)e.version=t,e.downloadlink=mainConfig.tabIconPath;log("tabSkinHandler success")}catch(e){log("tabSkinHandler fail")}return e}function skinPreviewHandler(e){return e.data.skin_info.status=1,e}function removeLuaScreenAds(e){if(!e.cached_ad)return e;for(const t of e.cached_ad.ads)t.start_date=1893254400,t.show_count=0,t.duration=0,t.end_date=1893340799;return e}function removePhpScreenAds(e){if(!e.ads)return e;e.show_push_splash_ad=!1,e.background_delay_display_time=0,e.lastAdShow_delay_display_time=0,e.realtime_ad_video_stall_time=0,e.realtime_ad_timeout_duration=0;for(const t of e.ads)t.displaytime=0,t.displayintervel=86400,t.allowdaydisplaynum=0,t.displaynum=0,t.displaytime=1,t.begintime="2029-12-30 00:00:00",t.endtime="2029-12-30 23:59:59";return e}function removeFlowPage(e){if(!e||!e.items)return e;for(let t=0;t<e.items.length;t++){const o=e.items[t];o.items?.length&&(o.items=o.items.filter((e=>!e.data?.actionlog?.ext?.includes("ads_word")&&!e.data?.itemid?.includes("ads_word")&&!e.itemExt?.anchorId?.includes("ads_word"))))}return log("removeFlowPage success"),e}function removeRepostTimeline(e){const t=[];for(const o of e.hot_reposts)isAd(o)||t.push(o);e.hot_reposts=t;const o=[];for(const t of e.reposts)isAd(t)||o.push(t);return e.reposts=o,log("removeRepostTimeline success"),e}function removeDetailComments(e){const t=e.items||[];if(!t.length)return e;const o=[];for(const e of t)if(!(e.commentAdType||isAd(e.data.blog)||e.data.user&&e.data.user.extend&&1===e.data.user.extend.ai_type)){const t=removeAi(e);o.push(t)}return e.items=o,log("removeDetailComments success"),e}function removeContainerDetail(e){return e.pageHeader?.data?.items?(e.pageHeader.data.items=e.pageHeader.data.items.filter((e=>!isAd(e.data)&&!["share","vertical"].includes(e.type))),log("removeContainerDetail success"),e):e}function log(e,t){mainConfig.isDebug}if("undefined"!=typeof $done){var{body:body}=$response,{url:url}=$request;const e=modifyWeiboBody(url,body);$done({body:e})}const method=getModifyMethod(url);if(method){log(method);const func=eval(method),data=JSON.parse(body.match(/\{.*\}/)[0]);new func(data),body=JSON.stringify(data),"removePhpScreenAds"==method&&(body=JSON.stringify(data)+"OK")}function modifyWeiboBody(url,bodyStr){try{const method=getModifyMethod(url);if(!method)return bodyStr;const func=eval(method),jsonMatch=bodyStr.match(/\{[\s\S]*\}/);if(!jsonMatch)return bodyStr;const data=JSON.parse(jsonMatch[0]);func(data);let result=JSON.stringify(data);return"removePhpScreenAds"===method&&(result+="OK"),result}catch(e){return bodyStr}}